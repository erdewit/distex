

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Distex documentation &mdash; distex 0.6.0 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://distex.readthedocs.ioapi.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Introduction" href="index.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> distex
          

          
          </a>

          
            
            
              <div class="version">
                0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Distex documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pool">Pool</a></li>
<li class="toctree-l2"><a class="reference internal" href="#poolmap">PoolMap</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">distex</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Distex documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="distex-documentation">
<span id="api"></span><h1>Distex documentation<a class="headerlink" href="#distex-documentation" title="Permalink to this headline">¶</a></h1>
<p>Release 0.6.0.</p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="pool">
<h2>Pool<a class="headerlink" href="#pool" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="distex.pool.Pool">
<em class="property">class </em><code class="descclassname">distex.pool.</code><code class="descname">Pool</code><span class="sig-paren">(</span><em>num_workers=None</em>, <em>hosts=None</em>, <em>qsize=2</em>, <em>initializer=None</em>, <em>initargs=()</em>, <em>localhost=None</em>, <em>localport=None</em>, <em>lazy_create=False</em>, <em>worker_loop=&lt;LoopType.default: 0&gt;</em>, <em>func_pickle=&lt;PickleType.dill: 2&gt;</em>, <em>data_pickle=&lt;PickleType.pickle: 0&gt;</em>, <em>loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool" title="Permalink to this definition">¶</a></dt>
<dd><p>Pool of local and remote workers that can run tasks.</p>
<p>To create a process pool of 4 local workers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>To create 8 remote workers on host <code class="docutils literal notranslate"><span class="pre">maxi</span></code>, using SSH (unix only):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ssh://maxi/8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">distex</span></code> must be installed on all remote hosts and the <code class="docutils literal notranslate"><span class="pre">distex_proc</span></code>
script must be in the path. Test this with <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">&lt;host&gt;</span> <span class="pre">distex_proc</span></code>.
When using SSH it is not necessary to have a distex server running
on the hosts.</p>
<p>When not using SSH a spawning server has to be started
first on all hosts involved:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">distex</span><span class="o">.</span><span class="n">server</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Only use this in a trusted network environment.</p>
</div>
<p>With the server running on host <code class="docutils literal notranslate"><span class="pre">mini</span></code>,
to create a pool of 2 workers running there:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mini/2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Local, remote SSH and remote non-SSH workers can all be
combined in one pool:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ssh://maxi/8&#39;</span><span class="p">,</span> <span class="s1">&#39;mini/2&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>To give a SSH username or a non-default port such as 10022, specify the
host as <code class="docutils literal notranslate"><span class="pre">'ssh://username&#64;maxi:10022/8'</span></code>.
It is not possible to give a password,
use SSH keys instead: <a class="reference external" href="https://linux.die.net/man/1/ssh-keygen">ssh-keygen</a> can be used to create a key and
<a class="reference external" href="https://linux.die.net/man/1/ssh-copy-id">ssh-copy-id</a> to copy it to all hosts.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>num_workers</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – Number of local process workers. The default of
None will use the number of CPUs.</li>
<li><strong>hosts</strong> – List of remote host specification strings in the format
<code class="docutils literal notranslate"><span class="pre">[ssh://][username&#64;]hostname[:portnumber]/num_workers</span></code>.</li>
<li><strong>qsize</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of pending tasks per worker.
To improve the throughput of small tasks this can be increased
from the default of 2.
If no queueing is desired then it can be set to 1.</li>
<li><strong>initializer</strong> – Callable to initialize worker processes.</li>
<li><strong>initargs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>) – Arguments tuple that is unpacked into the initializer.</li>
<li><strong>localhost</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – Local TCP server (if any) will listen on this address.</li>
<li><strong>localport</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – Local TCP server (if any) will listen on this port
(default: random open port).</li>
<li><strong>lazy_create</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If True then no workers will be created until the
first task is submitted.</li>
<li><strong>worker_loop</strong> – <p><code class="docutils literal notranslate"><span class="pre">LoopType</span></code> to use for workers:</p>
<blockquote>
<div><ol class="arabic" start="0">
<li>default (=uvloop when available, proactor on Windows)</li>
<li>asyncio (standard selector event loop)</li>
<li>uvloop (Unix only)</li>
<li>proactor (Windows only)</li>
<li>quamash (PyQt)</li>
</ol>
</div></blockquote>
</li>
<li><strong>func_pickle</strong> – <p><code class="docutils literal notranslate"><span class="pre">PickleType</span></code> to to use for serializing functions:</p>
<ol class="arabic" start="0">
<li>pickle</li>
<li>cloudpickle</li>
<li>dill</li>
</ol>
</li>
<li><strong>data_pickle</strong> – <p><code class="docutils literal notranslate"><span class="pre">PickleType</span></code> to to use for data:</p>
<ol class="arabic" start="0">
<li>pickle</li>
<li>cloudpickle</li>
<li>dill</li>
</ol>
</li>
<li><strong>loop</strong> – The asyncio event loop to run the pool in.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">distex.Pool</span></code> implements the <code class="docutils literal notranslate"><span class="pre">concurrent.futures.Executor</span></code>
interface and can be used in the place of ProcessPoolExecutor.</p>
<dl class="exception">
<dt id="distex.pool.Pool.TimeoutError">
<em class="property">exception </em><code class="descname">TimeoutError</code><a class="headerlink" href="#distex.pool.Pool.TimeoutError" title="Permalink to this definition">¶</a></dt>
<dd><p>The operation exceeded the given deadline.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.is_ready">
<code class="descname">is_ready</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.is_ready"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.is_ready" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the pool is ready to process tasks, false otherwise.</p>
<p>There is also the public <code class="docutils literal notranslate"><span class="pre">ready</span></code> event.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.total_workers">
<code class="descname">total_workers</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.total_workers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.total_workers" title="Permalink to this definition">¶</a></dt>
<dd><p>Total number of workers in the pool.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.submit">
<code class="descname">submit</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.submit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.submit" title="Permalink to this definition">¶</a></dt>
<dd><p>Submit the task to be run in the pool and return a
concurrent.futures.Future that will hold the result.</p>
<p>This method is provided for compatibility with
concurrent.futures.Executor.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.map">
<code class="descname">map</code><span class="sig-paren">(</span><em>func</em>, <em>*iterables</em>, <em>timeout=None</em>, <em>chunksize=1</em>, <em>ordered=True</em>, <em>star=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.map" title="Permalink to this definition">¶</a></dt>
<dd><p>Map the function onto the given iterable(s) and
return an iterator that yields the results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>func</strong> – Function to map. If it returns an awaitable then the
result is awaited and returned.</li>
<li><strong>iterables</strong> – Sync or async iterables (in any combination)
that yield the arguments for <code class="docutils literal notranslate"><span class="pre">func</span></code>. The iterables can
be unbounded (i.e. they don’t need to have a length).</li>
<li><strong>timeout</strong> – Timeout in seconds since map is started.</li>
<li><strong>chunksize</strong> – Iterator is chunked up to this size.
A larger chunksize can greatly improve efficiency
for small tasks.</li>
<li><strong>ordered</strong> – <ul>
<li><code class="docutils literal notranslate"><span class="pre">True</span></code>: The order of results preserves the
order of the input iterables.</li>
<li><code class="docutils literal notranslate"><span class="pre">False</span></code>: The results are in order of completion.</li>
</ul>
</li>
<li><strong>star</strong> – <ul>
<li><code class="docutils literal notranslate"><span class="pre">True</span></code>: There can be only one iterable and it must
yield sequences (such as tuples). The sequences are
unpacked (‘starred’) into <code class="docutils literal notranslate"><span class="pre">func</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">False</span></code>: The values that the iterators yield are
supplied in-place to <code class="docutils literal notranslate"><span class="pre">func</span></code>.</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The function <code class="docutils literal notranslate"><span class="pre">func</span></code> is is pickled only once and then cached.
If it takes arguments that remain constant during the mapping then
consider using <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> to bind the function with the
constant arguments; Then do the mapping with the bound function and
with lesser arguments. Especially when map uses large constant
datasets this can be beneficial.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the function with the given arguments
in the pool and wait for the result.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.run_on_all">
<code class="descname">run_on_all</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.run_on_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.run_on_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the task on each worker in the pool. Return a list of all results
(in order of completion) or raise an exception in case the task fails
on one or more workers.</p>
<p>Will first wait for any other pending tasks to finish and then
schedule the task over all workers at the same time.</p>
<p>This can be used for initializing, cleanup, intermittent polling, etc.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.create">
<code class="descname">create</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.create"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.create" title="Permalink to this definition">¶</a></dt>
<dd><p>Coroutine to create local processors and servers and
start up remote processors.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.map_async">
<code class="descname">map_async</code><span class="sig-paren">(</span><em>func</em>, <em>*iterables</em>, <em>timeout=None</em>, <em>chunksize=1</em>, <em>ordered=True</em>, <em>star=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.map_async"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.map_async" title="Permalink to this definition">¶</a></dt>
<dd><p>Async version of <code class="docutils literal notranslate"><span class="pre">map</span></code>. This runs with less overhead than <code class="docutils literal notranslate"><span class="pre">map</span></code>
and can be twice as fast for small tasks.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.run_async">
<code class="descname">run_async</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.run_async"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.run_async" title="Permalink to this definition">¶</a></dt>
<dd><p>Asynchronously run the function with the given arguments
in the pool and return the result when it becomes available.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.run_on_all_async">
<code class="descname">run_on_all_async</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.run_on_all_async"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.run_on_all_async" title="Permalink to this definition">¶</a></dt>
<dd><p>Async version of <code class="docutils literal notranslate"><span class="pre">run_on_all</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.shutdown_async">
<code class="descname">shutdown_async</code><span class="sig-paren">(</span><em>wait=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.shutdown_async"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.shutdown_async" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="distex.pool.Pool.shutdown">
<code class="descname">shutdown</code><span class="sig-paren">(</span><em>wait=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/pool.html#Pool.shutdown"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.pool.Pool.shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Shutdown the pool and clean up resources.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="poolmap">
<h2>PoolMap<a class="headerlink" href="#poolmap" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="distex.poolmap.PoolMap">
<em class="property">class </em><code class="descclassname">distex.poolmap.</code><code class="descname">PoolMap</code><span class="sig-paren">(</span><em>pool</em>, <em>func</em>, <em>timeout=None</em>, <em>chunksize=1</em>, <em>ordered=True</em>, <em>source=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/poolmap.html#PoolMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.poolmap.PoolMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Map a function using a distributed pool with
<a class="reference external" href="https://github.com/erdewit/eventkit">eventkit</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>func</strong> – Function to map. If it returns an awaitable then the
result will be awaited and returned.</li>
<li><strong>timeout</strong> – Timeout in seconds since map is started.</li>
<li><strong>chunksize</strong> – Source emits are chunked up to this size.
A larger chunksize can greatly improve efficiency
for small tasks.</li>
<li><strong>ordered</strong> – <ul>
<li><code class="docutils literal notranslate"><span class="pre">True</span></code>: The order of results preserves the source order.</li>
<li><code class="docutils literal notranslate"><span class="pre">False</span></code>: Results are in order of completion.</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="distex.poolmap.PoolMap.set_source">
<code class="descname">set_source</code><span class="sig-paren">(</span><em>source</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distex/poolmap.html#PoolMap.set_source"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#distex.poolmap.PoolMap.set_source" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Ewald de Wit

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>